/*! squel | https://github.com/hiddentao/squel | BSD license */"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():e.squel=t()}(void 0,function(){function e(e,t){return e.length?e+t:e}function t(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];if(e&&r){var i=!0,a=!1,o=void 0;try{for(var l,s=function(){var t=l.value;"object"===("undefined"==typeof t?"undefined":_typeof(t))&&Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=t[r])})},u=r[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)s()}catch(c){a=!0,o=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(a)throw o}}}return e}function r(e){return e&&e.constructor.prototype===Object.prototype}function n(e){return e&&e.constructor.prototype===Array.prototype}function i(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2===t.length)return t[1]}}function a(e){if(!e)return e;if("function"==typeof e.clone)return e.clone();if(!r(e)&&!n(e))return JSON.parse(JSON.stringify(e));var t=function(){var t=new e.constructor;return Object.getOwnPropertyNames(e).forEach(function(r){"function"!=typeof e[r]&&(t[r]=a(e[r]))}),{v:t}}();return"object"===("undefined"==typeof t?"undefined":_typeof(t))?t.v:void 0}function o(e,t,r){var n="undefined"==typeof t?"undefined":_typeof(t);if("function"!==n&&"string"!==n)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");for(var i in e){var a=e[i];if(a.type===t)return void(a.handler=r)}e.push({type:t,handler:r})}function l(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];for(var i in r){var a=r[i];for(var o in a){var l=a[o];if(("undefined"==typeof e?"undefined":_typeof(e))===l.type||"string"!=typeof l.type&&e instanceof l.type)return l.handler}}}function s(){var s=arguments.length<=0||void 0===arguments[0]?null:arguments[0],u={_getObjectClassName:i};u.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" "},u.globalValueHandlers=[],u.registerValueHandler=function(e,t){o(u.globalValueHandlers,e,t)},u.Cloneable=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"clone",value:function(){var e=new this.constructor;return t(e,a(t({},this)))}}]),e}(),u.BaseBuilder=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this)),i=JSON.parse(JSON.stringify(u.DefaultQueryBuilderOptions));return n.options=t({},i,e),n}return _inherits(r,e),_createClass(r,[{key:"registerValueHandler",value:function(e,t){return o(this.options.valueHandlers,e,t),this}},{key:"_sanitizeExpression",value:function(e){if(!(e instanceof u.Expression)&&"string"!=typeof e)throw new Error("expression must be a stringÂ or Expression instance");return e}},{key:"_sanitizeName",value:function(e,t){if("string"!=typeof e)throw new Error(t+" must be a string");return e}},{key:"_sanitizeField",value:function(e){return e instanceof u.BaseBuilder||(e=this._sanitizeName(e,"field name")),e}},{key:"_sanitizeQueryBuilder",value:function(e){if(e instanceof u.QueryBuilder)return e;throw new Error("must be a QueryBuilder instance")}},{key:"_sanitizeTable",value:function(e){if("string"!=typeof e)try{e=this._sanitizeQueryBuilder(e)}catch(t){throw new Error("table name must be a string or a query builder")}else e=this._sanitizeName(e,"table");return e}},{key:"_sanitizeTableAlias",value:function(e){return this._sanitizeName(e,"table alias")}},{key:"_sanitizeFieldAlias",value:function(e){return this._sanitizeName(e,"field alias")}},{key:"_sanitizeLimitOffset",value:function(e){if(e=parseInt(e),0>e||isNaN(e))throw new Error("limit/offset must be >= 0");return e}},{key:"_sanitizeValue",value:function(e){var t="undefined"==typeof e?"undefined":_typeof(e);if(null===e);else if("string"===t||"number"===t||"boolean"===t);else if(e instanceof u.BaseBuilder);else{var r=!!l(e,this.options.valueHandlers,u.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return e}},{key:"_escapeValue",value:function(e){return this.options.replaceSingleQuotes?e.replace(/\'/g,this.options.singleQuoteReplacement):e}},{key:"_formatTableName",value:function(e){if(this.options.autoQuoteTableNames){var t=this.options.nameQuoteCharacter;e=""+t+e+t}return e}},{key:"_formatFieldAlias",value:function(e){if(this.options.autoQuoteAliasNames){var t=this.options.fieldAliasQuoteCharacter;e=""+t+e+t}return e}},{key:"_formatTableAlias",value:function(e){if(this.options.autoQuoteAliasNames){var t=this.options.tableAliasQuoteCharacter;e=""+t+e+t}return this.options.useAsForTableAliasNames?"AS "+e:e}},{key:"_formatFieldName",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.options.autoQuoteFieldNames&&!function(){var n=t.options.nameQuoteCharacter;e=r.ignorePeriodsForFieldNameQuotes?""+n+e+n:e.split(".").map(function(e){return"*"===e?e:""+n+e+n}).join(".")}(),e}},{key:"_formatCustomValue",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],r=l(e,this.options.valueHandlers,u.globalValueHandlers);return r&&(e=r(e,t)),e}},{key:"_formatValueForParamArray",value:function(e){var t=this;return n(e)?e.map(function(e){return t._formatValueForParamArray(e)}):this._formatCustomValue(e,!0)}},{key:"_formatValueForQueryString",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=this._formatCustomValue(e);if(i!==e)return this._applyNestingFormatting(i);if(n(e))e=e.map(function(e){return t._formatValueForQueryString(e)}),e=this._applyNestingFormatting(e.join(", "));else{var a="undefined"==typeof e?"undefined":_typeof(e);if(null===e)e="NULL";else if("boolean"===a)e=e?"TRUE":"FALSE";else if(e instanceof u.BaseBuilder)e=this._applyNestingFormatting(e.toString());else if("number"!==a)if(r.dontQuote)e=""+e;else{var o=this._escapeValue(e);e="'"+o+"'"}}return e}},{key:"_applyNestingFormatting",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return!t||"("===e.charAt(0)&&")"===e.charAt(e.length-1)?e:"("+e+")"}},{key:"_buildString",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=r.nested,a=r.buildParameterized,o=r.formattingOptions;t=t||[],e=e||"";for(var l="",s=-1,c=[],h=this.options.parameterCharacter,f=0;e.length>f;)if(e.substr(f,h.length)===h){var v=t[++s];if(a)if(v instanceof u.BaseBuilder){var d=v._toParamString({buildParameterized:a,nested:!0});l+=d.text,c.push.apply(c,_toConsumableArray(d.values))}else if(v=this._formatValueForParamArray(v),n(v)){var _=v.map(function(){return h}).join(", ");l+="("+_+")",c.push.apply(c,_toConsumableArray(v))}else l+=h,c.push(v);else l+=this._formatValueForQueryString(v,o);f+=h.length}else l+=e.charAt(f),f++;return{text:this._applyNestingFormatting(l,!!i),values:c}}},{key:"_buildManyStrings",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=[],i=[];for(var a in e){var o=e[a],l=t[a],s=this._buildString(o,l,{buildParameterized:r.buildParameterized,nested:!1}),u=s.text,c=s.values;n.push(u),i.push.apply(i,_toConsumableArray(c))}return n=n.join(this.options.separator),{text:n.length?this._applyNestingFormatting(n,!!r.nested):"",values:i}}},{key:"_toParamString",value:function(e){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(e).text}},{key:"toParam",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(t({},e,{buildParameterized:!0}))}}]),r}(u.Cloneable),u.Expression=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._nodes=[],r}return _inherits(t,e),_createClass(t,[{key:"and",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return e=this._sanitizeExpression(e),this._nodes.push({type:"AND",expr:e,para:r}),this}},{key:"or",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return e=this._sanitizeExpression(e),this._nodes.push({type:"OR",expr:e,para:r}),this}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=[],r=[],n=!0,i=!1,a=void 0;try{for(var o,l=this._nodes[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value,c=s.type,h=s.expr,f=s.para,v=h instanceof u.Expression?h._toParamString({buildParameterized:e.buildParameterized,nested:!0}):this._buildString(h,f,{buildParameterized:e.buildParameterized}),d=v.text,_=v.values;t.length&&t.push(c),t.push(d),r.push.apply(r,_toConsumableArray(_))}}catch(p){i=!0,a=p}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw a}}return t=t.join(" "),{text:this._applyNestingFormatting(t,!!e.nested),values:r}}}]),t}(u.BaseBuilder),u.Case=function(n){function i(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,i);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,n));return r(e)&&(n=e,e=null),e&&(a._fieldName=a._sanitizeField(e)),a.options=t({},u.DefaultQueryBuilderOptions,n),a._cases=[],a._elseValue=null,a}return _inherits(i,n),_createClass(i,[{key:"when",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return this._cases.unshift({expression:e,values:r}),this}},{key:"then",value:function(e){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=e,this}},{key:"else",value:function(e){return this._elseValue=e,this}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,a=!1,o=void 0;try{for(var l,s=this._cases[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value,c=u.expression,h=u.values,f=u.result;r=e(r," ");var v=this._buildString(c,h,{buildParameterized:t.buildParameterized,nested:!0});r+="WHEN "+v.text+" THEN "+this._formatValueForQueryString(f),n.push.apply(n,_toConsumableArray(v.values))}}catch(d){a=!0,o=d}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return r.length?(r+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(r=this._fieldName+" "+r),r="CASE "+r):r=this._formatValueForQueryString(this._elseValue),{text:r,values:n}}}]),i}(u.BaseBuilder),u.Block=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"exposedMethods",value:function(){for(var e={},t=this;t;)Object.getOwnPropertyNames(t).forEach(function(r){"constructor"===r||"function"!=typeof t[r]||"_"===r.charAt(0)||u.Block.prototype[r]||(e[r]=t[r])}),t=Object.getPrototypeOf(t);return e}}]),t}(u.BaseBuilder),u.StringBlock=function(e){function t(e,r){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n._str=r,n}return _inherits(t,e),_createClass(t,[{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._str,values:[]}}}]),t}(u.Block),u.FunctionBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._strings=[],r._values=[],r}return _inherits(t,e),_createClass(t,[{key:"function",value:function(e){this._strings.push(e);for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];this._values.push(r)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._buildManyStrings(this._strings,this._values,e)}}]),t}(u.Block),u.registerValueHandler(u.FunctionBlock,function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return t?e.toParam():e.toString()}),u.AbstractTableBlock=function(t){function r(e,t){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return n._tables=[],n}return _inherits(r,t),_createClass(r,[{key:"_table",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t=t?this._sanitizeTableAlias(t):t,e=this._sanitizeTable(e),this.options.singleTable&&(this._tables=[]),this._tables.push({table:e,alias:t})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[];if(this._hasTable()){var i=!0,a=!1,o=void 0;try{for(var l,s=this._tables[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value,h=c.table,f=c.alias;r=e(r,", ");var v=h;if(h instanceof u.BaseBuilder){var d=h._toParamString({buildParameterized:t.buildParameterized,nested:!0}),_=d.text,p=d.values;v=_,n.push.apply(n,_toConsumableArray(p))}f&&(v+=" "+this._formatTableAlias(f)),r+=v}}catch(y){a=!0,o=y}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}this.options.prefix&&(r=this.options.prefix+" "+r)}return{text:r,values:n}}}]),r}(u.Block),u.UpdateTableBlock=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"table",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(e,t)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("table() needs to be called");return _get(Object.getPrototypeOf(t.prototype),"_toParamString",this).call(this,e)}}]),t}(u.AbstractTableBlock),u.FromTableBlock=function(e){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t({},e,{prefix:"FROM"})))}return _inherits(r,e),_createClass(r,[{key:"from",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(e,t)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _get(Object.getPrototypeOf(r.prototype),"_toParamString",this).call(this,e)}}]),r}(u.AbstractTableBlock),u.IntoTableBlock=function(e){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t({},e,{prefix:"INTO",singleTable:!0})))}return _inherits(r,e),_createClass(r,[{key:"into",value:function(e){this._table(e)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("into() needs to be called");return _get(Object.getPrototypeOf(r.prototype),"_toParamString",this).call(this,e)}}]),r}(u.AbstractTableBlock),u.GetFieldBlock=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t._fields=[],t}return _inherits(r,t),_createClass(r,[{key:"fields",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(n(e)){var r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var s=o.value;this.field(s,null,t)}}catch(u){i=!0,a=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw a}}}else for(var c in e){var h=e[c];this.field(c,h,t)}}},{key:"field",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];t=t?this._sanitizeFieldAlias(t):t,e=this._sanitizeField(e);var n=this._fields.filter(function(r){return r.name===e&&r.alias===t});return n.length?this:void this._fields.push({name:e,alias:t,options:r})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=t.queryBuilder,n=t.buildParameterized,i="",a=[],o=!0,l=!1,s=void 0;try{for(var c,h=this._fields[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var f=c.value;i=e(i,", ");var v=f.name,d=f.alias,_=f.options;if("string"==typeof v)i+=this._formatFieldName(v,_);else{var p=v._toParamString({nested:!0,buildParameterized:n});i+=p.text,a.push.apply(a,_toConsumableArray(p.values))}d&&(i+=" AS "+this._formatFieldAlias(d))}}catch(y){l=!0,s=y}finally{try{!o&&h["return"]&&h["return"]()}finally{if(l)throw s}}if(!i.length){var b=r&&r.getBlock(u.FromTableBlock);b&&b._hasTable()&&(i="*")}return{text:i,values:a}}}]),r}(u.Block),u.AbstractSetFieldBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._reset(),r}return _inherits(t,e),_createClass(t,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof t&&(t=this._sanitizeValue(t)),e=this._sanitizeField(e);var n=this._fields.indexOf(e);-1===n&&(this._fields.push(e),n=this._fields.length-1),this._values[0][n]=t,this._valueOptions[0][n]=r}},{key:"_setFields",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("Expected an object but got "+("undefined"==typeof e?"undefined":_typeof(e)));for(var r in e)this._set(r,e[r],t)}},{key:"_setFieldsRows",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!n(e))throw new Error("Expected an array of objects but got "+("undefined"==typeof e?"undefined":_typeof(e)));this._reset();for(var r in e){var i=e[r];for(var a in i){var o=i[a];a=this._sanitizeField(a),o=this._sanitizeValue(o);var l=this._fields.indexOf(a);if(r>0&&-1===l)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===l&&(this._fields.push(a),l=this._fields.length-1),n(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][l]=o,this._valueOptions[r][l]=t}}}}]),t}(u.Block),u.SetFieldBlock=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,t),_createClass(r,[{key:"set",value:function(e,t,r){this._set(e,t,r)}},{key:"setFields",value:function(e,t){this._setFields(e,t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=t.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");var n="",i=[];for(var a in this._fields){n=e(n,", ");var o=this._fields[a],l=this._values[0][a];if("undefined"==typeof l)n+=o;else{var s=this._buildString(o+" = "+this.options.parameterCharacter,[l],{buildParameterized:r,formattingOptions:this._valueOptions[0][a]});n+=s.text,i.push.apply(i,_toConsumableArray(s.values))}}return{text:"SET "+n,values:i}}}]),r}(u.AbstractSetFieldBlock),u.InsertFieldValueBlock=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,t),_createClass(r,[{key:"set",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this._set(e,t,r)}},{key:"setFields",value:function(e,t){this._setFields(e,t)}},{key:"setFieldsRows",value:function(e,t){this._setFieldsRows(e,t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=t.buildParameterized,n=this._fields.join(", "),i=[],a=[];for(var o in this._values){i[o]="";for(var l in this._values[o]){var s=this._buildString(this.options.parameterCharacter,[this._values[o][l]],{buildParameterized:r,formattingOptions:this._valueOptions[o][l]});a.push.apply(a,_toConsumableArray(s.values)),i[o]=e(i[o],", "),i[o]+=s.text}}return{text:n.length?"("+n+") VALUES ("+i.join("), (")+")":"",values:a}}}]),r}(u.AbstractSetFieldBlock),u.InsertFieldsFromQueryBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._fields=[],r._query=null,r}return _inherits(t,e),_createClass(t,[{key:"fromQuery",value:function(e,t){var r=this;this._fields=e.map(function(e){return r._sanitizeField(e)}),this._query=this._sanitizeQueryBuilder(t)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t="",r=[];if(this._fields.length&&this._query){var n=this._query._toParamString({buildParameterized:e.buildParameterized,nested:!0}),i=n.text,a=n.values;t="("+this._fields.join(", ")+") ("+i+")",r=a}return{text:t,values:r}}}]),t}(u.Block),u.DistinctBlock=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),t}(u.Block),u.GroupByBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._groups=[],r}return _inherits(t,e),_createClass(t,[{key:"group",value:function(e){this._groups.push(this._sanitizeField(e))}},{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),t}(u.Block),u.OffsetBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._offsets=null,r}return _inherits(t,e),_createClass(t,[{key:"offset",value:function(e){this._offsets=this._sanitizeLimitOffset(e)}},{key:"_toParamString",value:function(){return{text:this._offsets?"OFFSET "+this._offsets:"",values:[]}}}]),t}(u.Block),u.AbstractConditionBlock=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t._conditions=[],t}return _inherits(r,t),_createClass(r,[{key:"_condition",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];e=this._sanitizeExpression(e),this._conditions.push({expr:e,values:r})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,a=!1,o=void 0;try{for(var l,s=this._conditions[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value,h=c.expr,f=c.values;r=e(r,") AND (");var v=h instanceof u.Expression?h._toParamString({buildParameterized:t.buildParameterized}):this._buildString(h,f,{buildParameterized:t.buildParameterized});r+=v.text,n.push.apply(n,_toConsumableArray(v.values))}}catch(d){a=!0,o=d}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return{text:r.length?this.options.verb+" ("+r+")":"",values:n}}}]),r}(u.Block),u.WhereBlock=function(e){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t({},e,{verb:"WHERE"})))}return _inherits(r,e),_createClass(r,[{key:"where",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[e].concat(r))}}]),r}(u.AbstractConditionBlock),u.HavingBlock=function(e){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t({},e,{verb:"HAVING"})))}return _inherits(r,e),_createClass(r,[{key:"having",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[e].concat(r))}}]),r}(u.AbstractConditionBlock),u.OrderByBlock=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t._orders=[],t}return _inherits(r,t),_createClass(r,[{key:"order",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];e=this._sanitizeField(e),t=void 0===t?!0:t,t=null!==t?!!t:t,this._orders.push({field:e,dir:t,values:n})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,a=!1,o=void 0;try{for(var l,s=this._orders[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value,c=u.field,h=u.dir,f=u.values;r=e(r,", ");var v=this._buildString(c,f,{buildParameterized:t.buildParameterized});r+=v.text,n.push.apply(n,_toConsumableArray(v.values)),null!==h&&(r+=" "+(h?"ASC":"DESC"))}}catch(d){a=!0,o=d}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return{text:r.length?"ORDER BY "+r:"",values:n}}}]),r}(u.Block),u.LimitBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._limit=null,r}return _inherits(t,e),_createClass(t,[{key:"limit",value:function(e){this._limit=this._sanitizeLimitOffset(e)}},{key:"_toParamString",value:function(){return{text:null!==this._limit?"LIMIT "+this._limit:"",values:[]}}}]),t}(u.Block),u.JoinBlock=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t._joins=[],t}return _inherits(r,t),_createClass(r,[{key:"join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"INNER":arguments[3];e=this._sanitizeTable(e,!0),t=t?this._sanitizeTableAlias(t):t,r=r?this._sanitizeExpression(r):r,this._joins.push({type:n,table:e,alias:t,condition:r})}},{key:"left_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"LEFT")}},{key:"right_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"RIGHT")}},{key:"outer_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"OUTER")}},{key:"left_outer_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"LEFT OUTER")}},{key:"full_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"FULL")}},{key:"cross_join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(e,t,r,"CROSS")}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,a=!1,o=void 0;try{for(var l,s=this._joins[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value,h=c.type,f=c.table,v=c.alias,d=c.condition;r=e(r,this.options.separator);var _=void 0;if(f instanceof u.BaseBuilder){var p=f._toParamString({buildParameterized:t.buildParameterized,nested:!0});n.push.apply(n,_toConsumableArray(p.values)),_=p.text}else _=this._formatTableName(f);if(r+=h+" JOIN "+_,v&&(r+=" "+this._formatTableAlias(v)),d){r+=" ON ";var y=void 0;y=d instanceof u.Expression?d._toParamString({buildParameterized:t.buildParameterized}):this._buildString(d,[],{buildParameterized:t.buildParameterized}),r+=this._applyNestingFormatting(y.text),n.push.apply(n,_toConsumableArray(y.values))}}}catch(b){a=!0,o=b}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return{text:r,values:n}}}]),r}(u.Block),u.UnionBlock=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t._unions=[],t}return _inherits(r,t),_createClass(r,[{key:"union",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"UNION":arguments[1];e=this._sanitizeTable(e),this._unions.push({type:t,table:e})}},{key:"union_all",value:function(e){this.union(e,"UNION ALL")}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,a=!1,o=void 0;try{for(var l,s=this._unions[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value,h=c.type,f=c.table;r=e(r,this.options.separator);var v=void 0;if(f instanceof u.BaseBuilder){var d=f._toParamString({buildParameterized:t.buildParameterized,nested:!0});v=d.text,n.push.apply(n,_toConsumableArray(d.values))}else r=this._formatTableName(f);r+=h+" "+v}}catch(_){a=!0,o=_}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return{text:r,values:n}}}]),r}(u.Block),u.QueryBuilder=function(e){function r(e,t){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));n.blocks=t||[];var i=!0,a=!1,o=void 0;try{for(var l,s=n.blocks[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value,c=u.exposedMethods();for(var h in c){var f=c[h];if(void 0!==n[h])throw new Error("Builder already has a builder method called: "+h);!function(e,t,r){n[t]=function(){for(var t=arguments.length,i=Array(t),a=0;t>a;a++)i[a]=arguments[a];return r.call.apply(r,[e].concat(i)),n}}(u,h,f)}}}catch(v){a=!0,o=v}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw o}}return n}return _inherits(r,e),_createClass(r,[{key:"registerValueHandler",value:function(e,t){var n=!0,i=!1,a=void 0;try{for(var o,l=this.blocks[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;s.registerValueHandler(e,t)}}catch(u){i=!0,a=u}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw a}}return _get(Object.getPrototypeOf(r.prototype),"registerValueHandler",this).call(this,e,t),this}},{key:"updateOptions",value:function(e){
this.options=t({},this.options,e);var r=!0,n=!1,i=void 0;try{for(var a,o=this.blocks[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=a.value;l.options=t({},l.options,e)}}catch(s){n=!0,i=s}finally{try{!r&&o["return"]&&o["return"]()}finally{if(n)throw i}}}},{key:"_toParamString",value:function(){var e,r=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n=t({},this.options,n);var i=this.blocks.map(function(e){return e._toParamString({buildParameterized:n.buildParameterized,queryBuilder:r})}),a=i.map(function(e){return e.text}),o=i.map(function(e){return e.values}),l=a.filter(function(e){return 0<e.length}).join(n.separator),s=(e=[]).concat.apply(e,_toConsumableArray(o));return n.nested||n.numberedParameters&&!function(){var e=void 0!==n.numberedParametersStartAt?n.numberedParametersStartAt:1,t=n.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");l=l.replace(new RegExp(t,"g"),function(){return""+n.numberedParametersPrefix+e++})}(),{text:this._applyNestingFormatting(l,!!n.nested),values:s}}},{key:"clone",value:function(){var e=this.blocks.map(function(e){return e.clone()});return new this.constructor(this.options,e)}},{key:"getBlock",value:function(e){var t=this.blocks.filter(function(t){return t instanceof e});return t[0]}}]),r}(u.BaseBuilder),u.Select=function(e){function t(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),r=r||[new u.StringBlock(e,"SELECT"),new u.FunctionBlock(e),new u.DistinctBlock(e),new u.GetFieldBlock(e),new u.FromTableBlock(e),new u.JoinBlock(e),new u.WhereBlock(e),new u.GroupByBlock(e),new u.HavingBlock(e),new u.OrderByBlock(e),new u.LimitBlock(e),new u.OffsetBlock(e),new u.UnionBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,r))}return _inherits(t,e),t}(u.QueryBuilder),u.Update=function(e){function t(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),r=r||[new u.StringBlock(e,"UPDATE"),new u.UpdateTableBlock(e),new u.SetFieldBlock(e),new u.WhereBlock(e),new u.OrderByBlock(e),new u.LimitBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,r))}return _inherits(t,e),t}(u.QueryBuilder),u.Delete=function(e){function r(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),n=n||[new u.StringBlock(e,"DELETE"),new u.FromTableBlock(t({},e,{singleTable:!0})),new u.JoinBlock(e),new u.WhereBlock(e),new u.OrderByBlock(e),new u.LimitBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,n))}return _inherits(r,e),r}(u.QueryBuilder),u.Insert=function(e){function t(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),r=r||[new u.StringBlock(e,"INSERT"),new u.IntoTableBlock(e),new u.InsertFieldValueBlock(e),new u.InsertFieldsFromQueryBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,r))}return _inherits(t,e),t}(u.QueryBuilder);var c={VERSION:"5.0.0",flavour:s,expr:function(e){return new u.Expression(e)},"case":function(e,t){return new u.Case(e,t)},select:function(e,t){return new u.Select(e,t)},update:function(e,t){return new u.Update(e,t)},insert:function(e,t){return new u.Insert(e,t)},"delete":function(e,t){return new u.Delete(e,t)},str:function(){var e=new u.FunctionBlock;return e["function"].apply(e,arguments),e},registerValueHandler:u.registerValueHandler};return c.remove=c["delete"],c.cls=u,c}var u=s();return u.flavours={},u.useFlavour=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(!e)return u;if(u.flavours[e]instanceof Function){var t=s(e);return u.flavours[e].call(null,t),t.flavours=u.flavours,t.useFlavour=u.useFlavour,t}throw new Error("Flavour not available: "+e)},u.flavours.mysql=function(r){var n=r.cls;n.TargetTableBlock=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"target",value:function(e){this["function"](this._sanitizeTable(e))}}]),t}(n.FunctionBlock),n.MysqlOnDuplicateKeyUpdateBlock=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,t),_createClass(r,[{key:"onDupUpdate",value:function(e,t,r){this._set(e,t,r)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[];for(var i in this._fields){r=e(r,", ");var a=this._fields[i],o=this._values[0][i],l=this._valueOptions[0][i];if("undefined"==typeof o)r+=a;else{var s=this._buildString(a+" = "+this.options.parameterCharacter,[o],{buildParameterized:t.buildParameterized,formattingOptions:l});r+=s.text,n.push.apply(n,_toConsumableArray(s.values))}}return{text:r.length?"ON DUPLICATE KEY UPDATE "+r:"",values:n}}}]),r}(n.AbstractSetFieldBlock),n.Insert=function(e){function t(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),r=r||[new n.StringBlock(e,"INSERT"),new n.IntoTableBlock(e),new n.InsertFieldValueBlock(e),new n.InsertFieldsFromQueryBlock(e),new n.MysqlOnDuplicateKeyUpdateBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,r))}return _inherits(t,e),t}(n.QueryBuilder),n.Delete=function(e){function r(e){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),i=i||[new n.StringBlock(e,"DELETE"),new n.TargetTableBlock(e),new n.FromTableBlock(t({},e,{singleTable:!0})),new n.JoinBlock(e),new n.WhereBlock(e),new n.OrderByBlock(e),new n.LimitBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,i))}return _inherits(r,e),r}(n.QueryBuilder)},u.flavours.postgres=function(e){var r=e.cls;r.DefaultQueryBuilderOptions.numberedParameters=!0,r.DefaultQueryBuilderOptions.numberedParametersStartAt=1,r.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,r.DefaultQueryBuilderOptions.useAsForTableAliasNames=!0,r.ReturningBlock=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r._str=null,r}return _inherits(t,e),_createClass(t,[{key:"returning",value:function(e){this._str=this._sanitizeField(e)}},{key:"_toParamString",value:function(){return{text:this._str?"RETURNING "+this._str:"",values:[]}}}]),t}(r.Block),r.Insert=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),n=n||[new r.StringBlock(e,"INSERT"),new r.IntoTableBlock(e),new r.InsertFieldValueBlock(e),new r.InsertFieldsFromQueryBlock(e),new r.ReturningBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),t}(r.QueryBuilder),r.Update=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,t),n=n||[new r.StringBlock(e,"UPDATE"),new r.UpdateTableBlock(e),new r.SetFieldBlock(e),new r.FromTableBlock(e),new r.WhereBlock(e),new r.OrderByBlock(e),new r.LimitBlock(e),new r.ReturningBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),t}(r.QueryBuilder),r.Delete=function(e){function n(e){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,n),i=i||[new r.StringBlock(e,"DELETE"),new r.FromTableBlock(t({},e,{singleTable:!0})),new r.JoinBlock(e),new r.WhereBlock(e),new r.OrderByBlock(e),new r.LimitBlock(e),new r.ReturningBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,i))}return _inherits(n,e),n}(r.QueryBuilder)},u});