/*! squel | https://github.com/hiddentao/squel | BSD license */"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var l=i.get;if(void 0!==l)return l.call(n)},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.returnExportsGlobal=e()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e():t.squel=e()}(void 0,function(){function t(t,e){return t.length?t+e:t}function e(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];if(t&&r){var i=!0,o=!1,l=void 0;try{for(var s,a=function(){var e=s.value;"object"===("undefined"==typeof e?"undefined":_typeof(e))&&Object.getOwnPropertyNames(e).forEach(function(r){"function"!=typeof e[r]&&(t[r]=e[r])})},u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)a()}catch(c){o=!0,l=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}}return t}function r(t){return t&&t.constructor.prototype===Object.prototype}function n(t){return t&&t.constructor.prototype===Array.prototype}function i(t){if(t&&t.constructor&&t.constructor.toString){var e=t.constructor.toString().match(/function\s*(\w+)/);if(e&&2===e.length)return e[1]}}function o(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(!r(t)&&!n(t))return JSON.parse(JSON.stringify(t));var e=function(){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=o(t[r]))}),{v:e}}();return"object"===("undefined"==typeof e?"undefined":_typeof(e))?e.v:void 0}function l(t,e,r){var n="undefined"==typeof e?"undefined":_typeof(e);if("function"!==n&&"string"!==n)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");for(var i in t){var o=t[i];if(o.type===e)return void(o.handler=r)}t.push({type:e,handler:r})}function s(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];for(var i in r){var o=r[i];for(var l in o){var s=o[l];if(("undefined"==typeof t?"undefined":_typeof(t))===s.type||"string"!=typeof s.type&&t instanceof s.type)return s.handler}}}function a(){var a=arguments.length<=0||void 0===arguments[0]?null:arguments[0],u={_getObjectClassName:i};u.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" "},u.globalValueHandlers=[],u.registerValueHandler=function(t,e){l(u.globalValueHandlers,t,e)},u.Cloneable=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"clone",value:function(){var t=new this.constructor;return e(t,o(e({},this)))}}]),t}(),u.BaseBuilder=function(t){function r(t){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this)),i=JSON.parse(JSON.stringify(u.DefaultQueryBuilderOptions));return n.options=e({},i,t),n}return _inherits(r,t),_createClass(r,[{key:"registerValueHandler",value:function(t,e){return l(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!(t instanceof u.Expression)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or Expression instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){return t instanceof u.BaseBuilder||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeQueryBuilder",value:function(t){if(t instanceof u.QueryBuilder)return t;throw new Error("must be a QueryBuilder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeQueryBuilder(t)}catch(e){throw new Error("table name must be a string or a query builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e="undefined"==typeof t?"undefined":_typeof(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(t instanceof u.BaseBuilder);else{var r=!!s(t,this.options.valueHandlers,u.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t=""+e+t+e}return this.options.useAsForTableAliasNames?"AS "+t:t}},{key:"_formatFieldName",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.options.autoQuoteFieldNames&&!function(){var n=e.options.nameQuoteCharacter;t=r.ignorePeriodsForFieldNameQuotes?""+n+t+n:t.split(".").map(function(t){return"*"===t?t:""+n+t+n}).join(".")}(),t}},{key:"_formatCustomValue",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],r=s(t,this.options.valueHandlers,u.globalValueHandlers);return r&&(t=r(t,e)),t}},{key:"_formatValueForParamArray",value:function(t){var e=this;return n(t)?t.map(function(t){return e._formatValueForParamArray(t)}):this._formatCustomValue(t,!0)}},{key:"_formatValueForQueryString",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=this._formatCustomValue(t);if(i!==t)return this._applyNestingFormatting(i);if(n(t))t=t.map(function(t){return e._formatValueForQueryString(t)}),t=this._applyNestingFormatting(t.join(", "));else{var o="undefined"==typeof t?"undefined":_typeof(t);if(null===t)t="NULL";else if("boolean"===o)t=t?"TRUE":"FALSE";else if(t instanceof u.BaseBuilder)t=this._applyNestingFormatting(t.toString());else if("number"!==o)if(r.dontQuote)t=""+t;else{var l=this._escapeValue(t);t="'"+l+"'"}}return t}},{key:"_applyNestingFormatting",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return!e||"("===t.charAt(0)&&")"===t.charAt(t.length-1)?t:"("+t+")"}},{key:"_buildString",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=r.nested,o=r.buildParameterized,l=r.formattingOptions;e=e||[],t=t||"";for(var s="",a=-1,c=[],h=this.options.parameterCharacter,f=0;t.length>f;)if(t.substr(f,h.length)===h){var v=e[++a];if(o)if(v instanceof u.BaseBuilder){var _=v._toParamString({buildParameterized:o,nested:!0});s+=_.text,c.push.apply(c,_toConsumableArray(_.values))}else if(v=this._formatValueForParamArray(v),n(v)){var d=v.map(function(){return h}).join(", ");s+="("+d+")",c.push.apply(c,_toConsumableArray(v))}else s+=h,c.push(v);else s+=this._formatValueForQueryString(v,l);f+=h.length}else s+=t.charAt(f),f++;return{text:this._applyNestingFormatting(s,!!i),values:c}}},{key:"_buildManyStrings",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=[],i=[];for(var o in t){var l=t[o],s=e[o],a=this._buildString(l,s,{buildParameterized:r.buildParameterized,nested:!1}),u=a.text,c=a.values;n.push(u),i.push.apply(i,_toConsumableArray(c))}return n=n.join(this.options.separator),{text:n.length?this._applyNestingFormatting(n,!!r.nested):"",values:i}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(t).text}},{key:"toParam",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(e({},t,{buildParameterized:!0}))}}]),r}(u.Cloneable),u.Expression=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._nodes=[],r}return _inherits(e,t),_createClass(e,[{key:"and",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:r}),this}},{key:"or",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:r}),this}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[],r=[],n=!0,i=!1,o=void 0;try{for(var l,s=this._nodes[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var a=l.value,c=a.type,h=a.expr,f=a.para,v=h instanceof u.Expression?h._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(h,f,{buildParameterized:t.buildParameterized}),_=v.text,d=v.values;e.length&&e.push(c),e.push(_),r.push.apply(r,_toConsumableArray(d))}}catch(p){i=!0,o=p}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}return e=e.join(" "),{text:this._applyNestingFormatting(e,!!t.nested),values:r}}}]),e}(u.BaseBuilder),u.Case=function(n){function i(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,i);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,n));return r(t)&&(n=t,t=null),t&&(o._fieldName=o._sanitizeField(t)),o.options=e({},u.DefaultQueryBuilderOptions,n),o._cases=[],o._elseValue=null,o}return _inherits(i,n),_createClass(i,[{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return this._cases.unshift({expression:t,values:r}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,o=!1,l=void 0;try{for(var s,a=this._cases[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value,c=u.expression,h=u.values,f=u.result;r=t(r," ");var v=this._buildString(c,h,{buildParameterized:e.buildParameterized,nested:!0});r+="WHEN "+v.text+" THEN "+this._formatValueForQueryString(f),n.push.apply(n,_toConsumableArray(v.values))}}catch(_){o=!0,l=_}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return r.length?(r+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(r=this._fieldName+" "+r),r="CASE "+r):r=this._formatValueForQueryString(this._elseValue),{text:r,values:n}}}]),i}(u.BaseBuilder),u.Block=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(r){"constructor"===r||"function"!=typeof e[r]||"_"===r.charAt(0)||u.Block.prototype[r]||(t[r]=e[r])}),e=Object.getPrototypeOf(e);return t}}]),e}(u.BaseBuilder),u.StringBlock=function(t){function e(t,r){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return n._str=r,n}return _inherits(e,t),_createClass(e,[{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._str,values:[]}}}]),e}(u.Block),u.FunctionBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._strings=[],r._values=[],r}return _inherits(e,t),_createClass(e,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._values.push(r)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._buildManyStrings(this._strings,this._values,t)}}]),e}(u.Block),u.registerValueHandler(u.FunctionBlock,function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return e?t.toParam():t.toString()}),u.AbstractTableBlock=function(e){function r(t,e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return n._tables=[],n}return _inherits(r,e),_createClass(r,[{key:"_table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[];if(this._hasTable()){var i=!0,o=!1,l=void 0;try{for(var s,a=this._tables[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.table,f=c.alias;r=t(r,", ");var v=h;if(h instanceof u.BaseBuilder){var _=h._toParamString({buildParameterized:e.buildParameterized,nested:!0}),d=_.text,p=_.values;v=d,n.push.apply(n,_toConsumableArray(p))}f&&(v+=" "+this._formatTableAlias(f)),r+=v}}catch(y){o=!0,l=y}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}this.options.prefix&&(r=this.options.prefix+" "+r)}return{text:r,values:n}}}]),r}(u.Block),u.UpdateTableBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("table() needs to be called");return _get(Object.getPrototypeOf(e.prototype),"_toParamString",this).call(this,t)}}]),e}(u.AbstractTableBlock),u.FromTableBlock=function(t){function r(t){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e({},t,{prefix:"FROM"})))}return _inherits(r,t),_createClass(r,[{key:"from",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _get(Object.getPrototypeOf(r.prototype),"_toParamString",this).call(this,t)}}]),r}(u.AbstractTableBlock),u.IntoTableBlock=function(t){function r(t){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e({},t,{prefix:"INTO",singleTable:!0})))}return _inherits(r,t),_createClass(r,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("into() needs to be called");return _get(Object.getPrototypeOf(r.prototype),"_toParamString",this).call(this,t)}}]),r}(u.AbstractTableBlock),u.GetFieldBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._fields=[],e}return _inherits(r,e),_createClass(r,[{key:"fields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(n(t)){var r=!0,i=!1,o=void 0;try{for(var l,s=t[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var a=l.value;this.field(a,null,e)}}catch(u){i=!0,o=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}}else for(var c in t){var h=t[c];this.field(c,h,e)}}},{key:"field",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var n=this._fields.filter(function(r){return r.name===t&&r.alias===e});return n.length?this:void this._fields.push({name:t,alias:e,options:r})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.queryBuilder,n=e.buildParameterized,i="",o=[],l=!0,s=!1,a=void 0;try{for(var c,h=this._fields[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;i=t(i,", ");var v=f.name,_=f.alias,d=f.options;if("string"==typeof v)i+=this._formatFieldName(v,d);else{var p=v._toParamString({nested:!0,buildParameterized:n});i+=p.text,o.push.apply(o,_toConsumableArray(p.values))}_&&(i+=" AS "+this._formatFieldAlias(_))}}catch(y){s=!0,a=y}finally{try{!l&&h["return"]&&h["return"]()}finally{if(s)throw a}}if(!i.length){var b=r&&r.getBlock(u.FromTableBlock);b&&b._hasTable()&&(i="*")}return{text:i,values:o}}}]),r}(u.Block),u.AbstractSetFieldBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._reset(),r}return _inherits(e,t),_createClass(e,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var n=this._fields.indexOf(t);-1===n&&(this._fields.push(t),n=this._fields.length-1),this._values[0][n]=e,this._valueOptions[0][n]=r}},{key:"_setFields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("Expected an object but got "+("undefined"==typeof t?"undefined":_typeof(t)));for(var r in t)this._set(r,t[r],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!n(t))throw new Error("Expected an array of objects but got "+("undefined"==typeof t?"undefined":_typeof(t)));this._reset();for(var r in t){var i=t[r];for(var o in i){var l=i[o];o=this._sanitizeField(o),l=this._sanitizeValue(l);var s=this._fields.indexOf(o);if(r>0&&-1===s)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===s&&(this._fields.push(o),s=this._fields.length-1),n(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][s]=l,this._valueOptions[r][s]=e}}}}]),e}(u.Block),u.SetFieldBlock=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"set",value:function(t,e,r){this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");var n="",i=[];for(var o in this._fields){n=t(n,", ");var l=this._fields[o],s=this._values[0][o];if("undefined"==typeof s)n+=l;else{var a=this._buildString(l+" = "+this.options.parameterCharacter,[s],{buildParameterized:r,formattingOptions:this._valueOptions[0][o]});n+=a.text,i.push.apply(i,_toConsumableArray(a.values))}}return{text:"SET "+n,values:i}}}]),r}(u.AbstractSetFieldBlock),u.InsertFieldValueBlock=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.buildParameterized,n=this._fields.join(", "),i=[],o=[];for(var l in this._values){i[l]="";for(var s in this._values[l]){var a=this._buildString(this.options.parameterCharacter,[this._values[l][s]],{buildParameterized:r,formattingOptions:this._valueOptions[l][s]});o.push.apply(o,_toConsumableArray(a.values)),i[l]=t(i[l],", "),i[l]+=a.text}}return{text:n.length?"("+n+") VALUES ("+i.join("), (")+")":"",values:o}}}]),r}(u.AbstractSetFieldBlock),u.InsertFieldsFromQueryBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._fields=[],r._query=null,r}return _inherits(e,t),_createClass(e,[{key:"fromQuery",value:function(t,e){var r=this;this._fields=t.map(function(t){return r._sanitizeField(t)}),this._query=this._sanitizeQueryBuilder(e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",r=[];if(this._fields.length&&this._query){var n=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),i=n.text,o=n.values;e="("+this._fields.join(", ")+") ("+i+")",r=o}return{text:e,values:r}}}]),e}(u.Block),u.DistinctBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),e}(u.Block),u.GroupByBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._groups=[],r}return _inherits(e,t),_createClass(e,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),e}(u.Block),u.OffsetBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._offsets=null,r}return _inherits(e,t),_createClass(e,[{key:"offset",value:function(t){this._offsets=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){return{text:this._offsets?"OFFSET "+this._offsets:"",values:[]}}}]),e}(u.Block),u.AbstractConditionBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._conditions=[],e}return _inherits(r,e),_createClass(r,[{key:"_condition",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];t=this._sanitizeExpression(t),this._conditions.push({expr:t,values:r})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,o=!1,l=void 0;try{for(var s,a=this._conditions[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.expr,f=c.values;r=t(r,") AND (");var v=h instanceof u.Expression?h._toParamString({buildParameterized:e.buildParameterized}):this._buildString(h,f,{buildParameterized:e.buildParameterized});r+=v.text,n.push.apply(n,_toConsumableArray(v.values))}}catch(_){o=!0,l=_}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return{text:r.length?this.options.verb+" ("+r+")":"",values:n}}}]),r}(u.Block),u.WhereBlock=function(t){function r(t){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e({},t,{verb:"WHERE"})))}return _inherits(r,t),_createClass(r,[{key:"where",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),r}(u.AbstractConditionBlock),u.HavingBlock=function(t){function r(t){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e({},t,{verb:"HAVING"})))}return _inherits(r,t),_createClass(r,[{key:"having",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),r}(u.AbstractConditionBlock),u.OrderByBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._orders=[],e}return _inherits(r,e),_createClass(r,[{key:"order",value:function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];t=this._sanitizeField(t),e=void 0===e?!0:e,e=null!==e?!!e:e,this._orders.push({field:t,dir:e,values:n})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,o=!1,l=void 0;try{for(var s,a=this._orders[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value,c=u.field,h=u.dir,f=u.values;r=t(r,", ");var v=this._buildString(c,f,{buildParameterized:e.buildParameterized});r+=v.text,n.push.apply(n,_toConsumableArray(v.values)),null!==h&&(r+=" "+(h?"ASC":"DESC"))}}catch(_){o=!0,l=_}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return{text:r.length?"ORDER BY "+r:"",values:n}}}]),r}(u.Block),u.LimitBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._limit=null,r}return _inherits(e,t),_createClass(e,[{key:"limit",value:function(t){this._limit=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){return{text:null!==this._limit?"LIMIT "+this._limit:"",values:[]}}}]),e}(u.Block),u.JoinBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._joins=[],e}return _inherits(r,e),_createClass(r,[{key:"join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"INNER":arguments[3];t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,r=r?this._sanitizeExpression(r):r,this._joins.push({type:n,table:t,alias:e,condition:r})}},{key:"left_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"CROSS")}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,o=!1,l=void 0;try{for(var s,a=this._joins[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.type,f=c.table,v=c.alias,_=c.condition;r=t(r,this.options.separator);var d=void 0;if(f instanceof u.BaseBuilder){var p=f._toParamString({buildParameterized:e.buildParameterized,nested:!0});n.push.apply(n,_toConsumableArray(p.values)),d=p.text}else d=this._formatTableName(f);if(r+=h+" JOIN "+d,v&&(r+=" "+this._formatTableAlias(v)),_){r+=" ON ";var y=void 0;y=_ instanceof u.Expression?_._toParamString({buildParameterized:e.buildParameterized}):this._buildString(_,[],{buildParameterized:e.buildParameterized}),r+=this._applyNestingFormatting(y.text),n.push.apply(n,_toConsumableArray(y.values))}}}catch(b){o=!0,l=b}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return{text:r,values:n}}}]),r}(u.Block),u.UnionBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._unions=[],e}return _inherits(r,e),_createClass(r,[{key:"union",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"UNION":arguments[1];t=this._sanitizeTable(t),this._unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],i=!0,o=!1,l=void 0;try{for(var s,a=this._unions[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.type,f=c.table;r=t(r,this.options.separator);var v=void 0;if(f instanceof u.BaseBuilder){var _=f._toParamString({buildParameterized:e.buildParameterized,nested:!0});v=_.text,n.push.apply(n,_toConsumableArray(_.values))}else r=this._formatTableName(f);r+=h+" "+v}}catch(d){o=!0,l=d}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return{text:r,values:n}}}]),r}(u.Block),u.QueryBuilder=function(t){function r(t,e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));n.blocks=e||[];var i=!0,o=!1,l=void 0;try{for(var s,a=n.blocks[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value,c=u.exposedMethods();for(var h in c){var f=c[h];if(void 0!==n[h])throw new Error("Builder already has a builder method called: "+h);!function(t,e,r){n[e]=function(){for(var e=arguments.length,i=Array(e),o=0;e>o;o++)i[o]=arguments[o];return r.call.apply(r,[t].concat(i)),n}}(u,h,f)}}}catch(v){o=!0,l=v}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw l}}return n}return _inherits(r,t),_createClass(r,[{key:"registerValueHandler",value:function(t,e){var n=!0,i=!1,o=void 0;try{for(var l,s=this.blocks[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var a=l.value;a.registerValueHandler(t,e)}}catch(u){i=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}return _get(Object.getPrototypeOf(r.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){
this.options=e({},this.options,t);var r=!0,n=!1,i=void 0;try{for(var o,l=this.blocks[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var s=o.value;s.options=e({},s.options,t)}}catch(a){n=!0,i=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(n)throw i}}}},{key:"_toParamString",value:function(){var t,r=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n=e({},this.options,n);var i=this.blocks.map(function(t){return t._toParamString({buildParameterized:n.buildParameterized,queryBuilder:r})}),o=i.map(function(t){return t.text}),l=i.map(function(t){return t.values}),s=o.filter(function(t){return 0<t.length}).join(n.separator),a=(t=[]).concat.apply(t,_toConsumableArray(l));return n.nested||n.numberedParameters&&!function(){var t=void 0!==n.numberedParametersStartAt?n.numberedParametersStartAt:1,e=n.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");s=s.replace(new RegExp(e,"g"),function(){return""+n.numberedParametersPrefix+t++})}(),{text:this._applyNestingFormatting(s,!!n.nested),values:a}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),r}(u.BaseBuilder),u.Select=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new u.StringBlock(t,"SELECT"),new u.FunctionBlock(t),new u.DistinctBlock(t),new u.GetFieldBlock(t),new u.FromTableBlock(t),new u.JoinBlock(t),new u.WhereBlock(t),new u.GroupByBlock(t),new u.HavingBlock(t),new u.OrderByBlock(t),new u.LimitBlock(t),new u.OffsetBlock(t),new u.UnionBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(u.QueryBuilder),u.Update=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new u.StringBlock(t,"UPDATE"),new u.UpdateTableBlock(t),new u.SetFieldBlock(t),new u.WhereBlock(t),new u.OrderByBlock(t),new u.LimitBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(u.QueryBuilder),u.Delete=function(t){function r(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),n=n||[new u.StringBlock(t,"DELETE"),new u.FromTableBlock(e({},t,{singleTable:!0})),new u.JoinBlock(t),new u.WhereBlock(t),new u.OrderByBlock(t),new u.LimitBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t,n))}return _inherits(r,t),r}(u.QueryBuilder),u.Insert=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new u.StringBlock(t,"INSERT"),new u.IntoTableBlock(t),new u.InsertFieldValueBlock(t),new u.InsertFieldsFromQueryBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(u.QueryBuilder);var c={VERSION:"5.0.0",flavour:a,expr:function(t){return new u.Expression(t)},"case":function(t,e){return new u.Case(t,e)},select:function(t,e){return new u.Select(t,e)},update:function(t,e){return new u.Update(t,e)},insert:function(t,e){return new u.Insert(t,e)},"delete":function(t,e){return new u.Delete(t,e)},str:function(){var t=new u.FunctionBlock;return t["function"].apply(t,arguments),t},registerValueHandler:u.registerValueHandler};return c.remove=c["delete"],c.cls=u,c}var u=a();return u.flavours={},u.useFlavour=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(!t)return u;if(u.flavours[t]instanceof Function){var e=a(t);return u.flavours[t].call(null,e),e.flavours=u.flavours,e.useFlavour=u.useFlavour,e}throw new Error("Flavour not available: "+t)},u.flavours.mssql=function(r){var n=r.cls;n.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,n.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,n.DefaultQueryBuilderOptions.numberedParametersPrefix="@",r.registerValueHandler(Date,function(t){return"'"+t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()+"'"}),n.MssqlLimitOffsetTopBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));r._limits=null,r._offsets=null;var i=function(t){t=this._sanitizeLimitOffset(t),this._parent._limits=t};return r.ParentBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t.options));return r._parent=t,r}return _inherits(e,t),e}(n.Block),r.LimitBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.limit=i,r}return _inherits(e,t),_createClass(e,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&this._parent._offsets&&(t="FETCH NEXT "+this._parent._limits+" ROWS ONLY"),{text:t,values:[]}}}]),e}(r.ParentBlock),r.TopBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.top=i,r}return _inherits(e,t),_createClass(e,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&!this._parent._offsets&&(t="TOP ("+this._parent._limits+")"),{text:t,values:[]}}}]),e}(r.ParentBlock),r.OffsetBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"offset",value:function(t){this._parent._offsets=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t="";return this._parent._offsets&&(t="OFFSET "+this._parent._offsets+" ROWS"),{text:t,values:[]}}}]),e}(r.ParentBlock),r}return _inherits(e,t),_createClass(e,[{key:"LIMIT",value:function(){return new this.LimitBlock(this)}},{key:"TOP",value:function(){return new this.TopBlock(this)}},{key:"OFFSET",value:function(){return new this.OffsetBlock(this)}}]),e}(n.Block),n.MssqlUpdateTopBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._limits=null,r.limit=r.top=function(t){r._limits=r._sanitizeLimitOffset(t)},r}return _inherits(e,t),_createClass(e,[{key:"_toParamString",value:function(){return{text:this._limits?"TOP ("+this._limits+")":"",values:[]}}}]),e}(n.Block),n.MssqlInsertFieldValueBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._outputs=[],r}return _inherits(e,t),_createClass(e,[{key:"output",value:function(t){var e=this;"string"==typeof t?this._outputs.push("INSERTED."+this._sanitizeField(t)):t.forEach(function(t){e._outputs.push("INSERTED."+e._sanitizeField(t))})}},{key:"_toParamString",value:function(t){if(0>=this._fields.length)throw new Error("set() needs to be called");var r=_get(Object.getPrototypeOf(e.prototype),"_toParamString",this).call(this,t);if(r.text.length&&0<this._outputs.length){var n="OUTPUT "+this._outputs.join(", ")+" ",i=r.text.indexOf("VALUES");r.text=r.text.substr(0,i)+n+r.text.substr(i)}return r}}]),e}(n.InsertFieldValueBlock),n.MssqlUpdateDeleteOutputBlock=function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));return e._outputs=[],e}return _inherits(r,e),_createClass(r,[{key:"outputs",value:function(t){for(var e in t)this.output(e,t[e])}},{key:"output",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t=this._sanitizeField(t),e=e?this._sanitizeFieldAlias(e):e,this._outputs.push({name:this.options.forDelete?"DELETED."+t:"INSERTED."+t,alias:e})}},{key:"_toParamString",value:function(e){var r="";if(this._outputs.length){var n=!0,i=!1,o=void 0;try{for(var l,s=this._outputs[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var a=l.value;r=t(r,", "),r+=a.name,a.alias&&(r+=" AS "+this._formatFieldAlias(a.alias))}}catch(u){i=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}r="OUTPUT "+r}return{text:r,values:[]}}}]),r}(n.Block),n.Select=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];_classCallCheck(this,e);var i=new n.MssqlLimitOffsetTopBlock(t);return r=r||[new n.StringBlock(t,"SELECT"),new n.DistinctBlock(t),i.TOP(),new n.GetFieldBlock(t),new n.FromTableBlock(t),new n.JoinBlock(t),new n.WhereBlock(t),new n.GroupByBlock(t),new n.OrderByBlock(t),i.OFFSET(),i.LIMIT(),new n.UnionBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(n.QueryBuilder),n.Update=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new n.StringBlock(t,"UPDATE"),new n.MssqlUpdateTopBlock(t),new n.UpdateTableBlock(t),new n.SetFieldBlock(t),new n.MssqlUpdateDeleteOutputBlock(t),new n.WhereBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(n.QueryBuilder),n.Delete=function(t){function r(t){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),i=i||[new n.StringBlock(t,"DELETE"),new n.FromTableBlock(e({},t,{singleTable:!0})),new n.JoinBlock(t),new n.MssqlUpdateDeleteOutputBlock(e({},t,{forDelete:!0})),new n.WhereBlock(t),new n.OrderByBlock(t),new n.LimitBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t,i))}return _inherits(r,t),r}(n.QueryBuilder),n.Insert=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new n.StringBlock(t,"INSERT"),new n.IntoTableBlock(t),new n.MssqlInsertFieldValueBlock(t),new n.InsertFieldsFromQueryBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(n.QueryBuilder)},u.flavours.mysql=function(r){var n=r.cls;n.TargetTableBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"target",value:function(t){this["function"](this._sanitizeTable(t))}}]),e}(n.FunctionBlock),n.MysqlOnDuplicateKeyUpdateBlock=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"onDupUpdate",value:function(t,e,r){this._set(t,e,r)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[];for(var i in this._fields){r=t(r,", ");var o=this._fields[i],l=this._values[0][i],s=this._valueOptions[0][i];if("undefined"==typeof l)r+=o;else{var a=this._buildString(o+" = "+this.options.parameterCharacter,[l],{buildParameterized:e.buildParameterized,formattingOptions:s});r+=a.text,n.push.apply(n,_toConsumableArray(a.values))}}return{text:r.length?"ON DUPLICATE KEY UPDATE "+r:"",values:n}}}]),r}(n.AbstractSetFieldBlock),n.Insert=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new n.StringBlock(t,"INSERT"),new n.IntoTableBlock(t),new n.InsertFieldValueBlock(t),new n.InsertFieldsFromQueryBlock(t),new n.MysqlOnDuplicateKeyUpdateBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(n.QueryBuilder),n.Delete=function(t){function r(t){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),i=i||[new n.StringBlock(t,"DELETE"),new n.TargetTableBlock(t),new n.FromTableBlock(e({},t,{singleTable:!0})),new n.JoinBlock(t),new n.WhereBlock(t),new n.OrderByBlock(t),new n.LimitBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t,i))}return _inherits(r,t),r}(n.QueryBuilder)},u.flavours.postgres=function(t){var r=t.cls;r.DefaultQueryBuilderOptions.numberedParameters=!0,r.DefaultQueryBuilderOptions.numberedParametersStartAt=1,r.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,r.DefaultQueryBuilderOptions.useAsForTableAliasNames=!0,r.ReturningBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._str=null,r}return _inherits(e,t),_createClass(e,[{key:"returning",value:function(t){this._str=this._sanitizeField(t)}},{key:"_toParamString",value:function(){return{text:this._str?"RETURNING "+this._str:"",values:[]}}}]),e}(r.Block),r.Insert=function(t){function e(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),n=n||[new r.StringBlock(t,"INSERT"),new r.IntoTableBlock(t),new r.InsertFieldValueBlock(t),new r.InsertFieldsFromQueryBlock(t),new r.ReturningBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n))}return _inherits(e,t),e}(r.QueryBuilder),r.Update=function(t){function e(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),n=n||[new r.StringBlock(t,"UPDATE"),new r.UpdateTableBlock(t),new r.SetFieldBlock(t),new r.FromTableBlock(t),new r.WhereBlock(t),new r.OrderByBlock(t),new r.LimitBlock(t),new r.ReturningBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n))}return _inherits(e,t),e}(r.QueryBuilder),r.Delete=function(t){function n(t){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,n),i=i||[new r.StringBlock(t,"DELETE"),new r.FromTableBlock(e({},t,{singleTable:!0})),new r.JoinBlock(t),new r.WhereBlock(t),new r.OrderByBlock(t),new r.LimitBlock(t),new r.ReturningBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,t,i))}return _inherits(n,t),n}(r.QueryBuilder)},u});