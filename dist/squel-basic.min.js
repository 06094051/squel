/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){"use strict";function t(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){return t.length?t+e:t}function o(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(t&&r){var n=!0,o=!1,a=void 0;try{for(var l,u=function(){var e=l.value;"object"===("undefined"==typeof e?"undefined":p(e))&&Object.getOwnPropertyNames(e).forEach(function(r){t[r]=e[r]})},s=r[Symbol.iterator]();!(n=(l=s.next()).done);n=!0)u()}catch(f){o=!0,a=f}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw a}}}return t}function a(t){return t&&t.constructor.prototype===Object.prototype}function l(t){return t&&t.constructor.prototype===Array.prototype}function u(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(a(t)||l(t)){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=u(t[r]))}),e}return JSON.parse(JSON.stringify(t))}function s(t,e,r){var i="undefined"==typeof e?"undefined":p(e);if("function"!==i&&"string"!==i)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");var n=!0,o=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var s=l.value;if(s.type===e)return void(s.handler=r)}}catch(f){o=!0,a=f}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw a}}t.push({type:e,handler:r})}function f(t,e,r){return c(t,e)||c(t,r)}function c(t,e){for(var r=0;r<e.length;r++){var i=e[r];if(("undefined"==typeof t?"undefined":p(t))===i.type||"string"!=typeof i.type&&t instanceof i.type)return i.handler}}function h(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h={isSquelBuilder:function(t){return t&&!!t._toParamString}},_=function(t){return!h.isSquelBuilder(t)||!t.options.rawNesting};h.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},h.globalValueHandlers=[],h.registerValueHandler=function(t,e){s(h.globalValueHandlers,t,e)},h.Cloneable=function(){function t(){i(this,t)}return d(t,[{key:"clone",value:function(){var t=new this.constructor;return o(t,u(o({},this)))}}]),t}(),h.BaseBuilder=function(n){function a(t){i(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this)),n=JSON.parse(JSON.stringify(h.DefaultQueryBuilderOptions));return r.options=o({},n,t),r}return r(a,n),d(a,[{key:"registerValueHandler",value:function(t,e){return s(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!h.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){return h.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(h.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(e){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e="undefined"==typeof t?"undefined":p(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(h.isSquelBuilder(t));else{var r=!!f(t,this.options.valueHandlers,h.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t=""+e+t+e}return this.options.useAsForTableAliasNames?"AS "+t:t}},{key:"_formatFieldName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options.autoQuoteFieldNames){var r=this.options.nameQuoteCharacter;t=e.ignorePeriodsForFieldNameQuotes?""+r+t+r:t.split(".").map(function(t){return"*"===t?t:""+r+t+r}).join(".")}return t}},{key:"_formatCustomValue",value:function(t,e,r){var i=f(t,this.options.valueHandlers,h.globalValueHandlers);return i&&(t=i(t,e,r),t&&t.rawNesting)?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!i,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(t)?t.map(function(t){return e._formatValueForParamArray(t,r)}):this._formatCustomValue(t,!0,r).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._formatCustomValue(t,!1,r),n=i.rawNesting,o=i.formatted,a=i.value;if(o)return n?a:this._applyNestingFormatting(a,_(t));if(l(a))a=a.map(function(t){return e._formatValueForQueryString(t)}),a=this._applyNestingFormatting(a.join(", "),_(a));else{var u="undefined"==typeof a?"undefined":p(a);if(null===a)a="NULL";else if("boolean"===u)a=a?"TRUE":"FALSE";else if(h.isSquelBuilder(a))a=this._applyNestingFormatting(a.toString(),_(a));else if("number"!==u){if("string"===u&&this.options.stringFormatter)return this.options.stringFormatter(a);if(r.dontQuote)a=""+a;else{var s=this._escapeValue(a);a="'"+s+"'"}}}return a}},{key:"_applyNestingFormatting",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var r="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(r)for(var i=0,n=1;t.length-1>++i;){var o=t.charAt(i);if("("===o)n++;else if(")"===o&&(n--,1>n)){r=!1;break}}r||(t="("+t+")")}return t}},{key:"_buildString",value:function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.nested,o=i.buildParameterized,a=i.formattingOptions;r=r||[],e=e||"";for(var u="",s=-1,f=[],c=this.options.parameterCharacter,v=0;e.length>v;)if(e.substr(v,c.length)===c){var d=r[++s];if(o)if(h.isSquelBuilder(d)){var p=d._toParamString({buildParameterized:o,nested:!0});u+=p.text,f.push.apply(f,t(p.values))}else if(d=this._formatValueForParamArray(d,a),l(d)){var _=d.map(function(){return c}).join(", ");u+="("+_+")",f.push.apply(f,t(d))}else u+=c,f.push(d);else u+=this._formatValueForQueryString(d,a);v+=c.length}else u+=e.charAt(v),v++;return{text:this._applyNestingFormatting(u,!!n),values:f}}},{key:"_buildManyStrings",value:function(e,r){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=[],o=[],a=0;e.length>a;++a){var l=e[a],u=r[a],s=this._buildString(l,u,{buildParameterized:i.buildParameterized,nested:!1}),f=s.text,c=s.values;n.push(f),o.push.apply(o,t(c))}return n=n.join(this.options.separator),{text:n.length?this._applyNestingFormatting(n,!!i.nested):"",values:o}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(t).text}},{key:"toParam",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(o({},t,{buildParameterized:!0}))}}]),a}(h.Cloneable),h.Expression=function(n){function o(t){i(this,o);var r=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return r._nodes=[],r}return r(o,n),d(o,[{key:"and",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:r}),this}},{key:"or",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:r}),this}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[],i=[],n=!0,o=!1,a=void 0;try{for(var l,u=this._nodes[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var s=l.value,f=s.type,c=s.expr,v=s.para,d=h.isSquelBuilder(c)?c._toParamString({buildParameterized:e.buildParameterized,nested:!0}):this._buildString(c,v,{buildParameterized:e.buildParameterized}),p=d.text,_=d.values;r.length&&r.push(f),r.push(p),i.push.apply(i,t(_))}}catch(y){o=!0,a=y}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw a}}return r=r.join(" "),{text:this._applyNestingFormatting(r,!!e.nested),values:i}}}]),o}(h.BaseBuilder),h.Case=function(l){function u(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,u);var n=e(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,r));return a(t)&&(r=t,t=null),t&&(n._fieldName=n._sanitizeField(t)),n.options=o({},h.DefaultQueryBuilderOptions,r),n._cases=[],n._elseValue=null,n}return r(u,l),d(u,[{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._cases.unshift({expression:t,values:r}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="",i=[],o=!0,a=!1,l=void 0;try{for(var u,s=this._cases[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=f.expression,h=f.values,v=f.result;r=n(r," ");var d=this._buildString(c,h,{buildParameterized:e.buildParameterized,nested:!0});r+="WHEN "+d.text+" THEN "+this._formatValueForQueryString(v),i.push.apply(i,t(d.values))}}catch(p){a=!0,l=p}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}return r.length?(r+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(r=this._fieldName+" "+r),r="CASE "+r):r=this._formatValueForQueryString(this._elseValue),{text:r,values:i}}}]),u}(h.BaseBuilder),h.Block=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return r(n,t),d(n,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(r){"constructor"===r||"function"!=typeof e[r]||"_"===r.charAt(0)||h.Block.prototype[r]||(t[r]=e[r])}),e=Object.getPrototypeOf(e);return t}}]),n}(h.BaseBuilder),h.StringBlock=function(t){function n(t,r){i(this,n);var o=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return o._str=r,o}return r(n,t),d(n,[{key:"_toParamString",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{text:this._str,values:[]}}}]),n}(h.Block),h.FunctionBlock=function(t){function n(t){i(this,n);var r=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r._strings=[],r._values=[],r}return r(n,t),d(n,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._values.push(r)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._buildManyStrings(this._strings,this._values,t)}}]),n}(h.Block),h.registerValueHandler(h.FunctionBlock,function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?t.toParam():t.toString()}),h.AbstractTableBlock=function(o){function a(t,r){i(this,a);var n=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return n._tables=[],n}return r(a,o),d(a,[{key:"_table",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="",i=[];if(this._hasTable()){var o=!0,a=!1,l=void 0;try{for(var u,s=this._tables[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=f.table,v=f.alias;r=n(r,", ");var d=void 0;if(h.isSquelBuilder(c)){var p=c._toParamString({buildParameterized:e.buildParameterized,nested:!0}),_=p.text,y=p.values;d=_,i.push.apply(i,t(y))}else d=this._formatTableName(c);v&&(d+=" "+this._formatTableAlias(v)),r+=d}}catch(g){a=!0,l=g}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}this.options.prefix&&(r=this.options.prefix+" "+r)}return{text:r,values:i}}}]),a}(h.Block),h.TargetTableBlock=function(t){function n(){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return r(n,t),d(n,[{key:"target",value:function(t){this._table(t)}}]),n}(h.AbstractTableBlock),h.UpdateTableBlock=function(t){function n(){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return r(n,t),d(n,[{key:"table",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("table() needs to be called");return v(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_toParamString",this).call(this,t)}}]),n}(h.AbstractTableBlock),h.FromTableBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{prefix:"FROM"})))}return r(n,t),d(n,[{key:"from",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}}]),n}(h.AbstractTableBlock),h.IntoTableBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{prefix:"INTO",singleTable:!0})))}return r(n,t),d(n,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("into() needs to be called");return v(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_toParamString",this).call(this,t)}}]),n}(h.AbstractTableBlock),h.GetFieldBlock=function(o){function a(t){i(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return r._fields=[],r}return r(a,o),d(a,[{key:"fields",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(l(t)){var r=!0,i=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;this.field(u,null,e)}}catch(s){i=!0,n=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw n}}}else for(var f in t){var c=t[f];this.field(f,c,e)}}},{key:"field",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var i=this._fields.filter(function(r){return r.name===t&&r.alias===e});return i.length?this:void this._fields.push({name:t,alias:e,options:r})}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.queryBuilder,i=e.buildParameterized,o="",a=[],l=!0,u=!1,s=void 0;try{for(var f,c=this._fields[Symbol.iterator]();!(l=(f=c.next()).done);l=!0){var v=f.value;o=n(o,", ");var d=v.name,p=v.alias,_=v.options;if("string"==typeof d)o+=this._formatFieldName(d,_);else{var y=d._toParamString({nested:!0,buildParameterized:i});o+=y.text,a.push.apply(a,t(y.values))}p&&(o+=" AS "+this._formatFieldAlias(p))}}catch(g){u=!0,s=g}finally{try{!l&&c["return"]&&c["return"]()}finally{if(u)throw s}}if(!o.length){var b=r&&r.getBlock(h.FromTableBlock);b&&b._hasTable()&&(o="*")}return{text:o,values:a}}}]),a}(h.Block),h.AbstractSetFieldBlock=function(t){function n(t){i(this,n);var r=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r._reset(),r}return r(n,t),d(n,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var i=this._fields.indexOf(t);-1===i&&(this._fields.push(t),i=this._fields.length-1),this._values[0][i]=e,this._valueOptions[0][i]=r}},{key:"_setFields",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==("undefined"==typeof t?"undefined":p(t)))throw new Error("Expected an object but got "+("undefined"==typeof t?"undefined":p(t)));for(var r in t)this._set(r,t[r],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!l(t))throw new Error("Expected an array of objects but got "+("undefined"==typeof t?"undefined":p(t)));this._reset();for(var r=0;t.length>r;++r){var i=t[r];for(var n in i){var o=i[n];n=this._sanitizeField(n),o=this._sanitizeValue(o);var a=this._fields.indexOf(n);if(0<r&&-1===a)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===a&&(this._fields.push(n),a=this._fields.length-1),l(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][a]=o,this._valueOptions[r][a]=e}}}}]),n}(h.Block),h.SetFieldBlock=function(o){function a(){return i(this,a),e(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return r(a,o),d(a,[{key:"set",value:function(t,e,r){this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");for(var i="",o=[],a=0;a<this._fields.length;++a){i=n(i,", ");var l=this._formatFieldName(this._fields[a]),u=this._values[0][a];0>l.indexOf("=")&&(l=l+" = "+this.options.parameterCharacter);var s=this._buildString(l,[u],{buildParameterized:r,formattingOptions:this._valueOptions[0][a]});i+=s.text,o.push.apply(o,t(s.values))}return{text:"SET "+i,values:o}}}]),a}(h.AbstractSetFieldBlock),h.InsertFieldValueBlock=function(o){function a(){return i(this,a),e(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return r(a,o),d(a,[{key:"set",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.buildParameterized,o=this._fields.map(function(t){return e._formatFieldName(t)}).join(", "),a=[],l=[],u=0;u<this._values.length;++u){a[u]="";for(var s=0;s<this._values[u].length;++s){var f=this._buildString(this.options.parameterCharacter,[this._values[u][s]],{buildParameterized:i,formattingOptions:this._valueOptions[u][s]});l.push.apply(l,t(f.values)),a[u]=n(a[u],", "),a[u]+=f.text}}return{text:o.length?"("+o+") VALUES ("+a.join("), (")+")":"",values:l}}}]),a}(h.AbstractSetFieldBlock),h.InsertFieldsFromQueryBlock=function(t){function n(t){i(this,n);var r=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r._fields=[],r._query=null,r}return r(n,t),d(n,[{key:"fromQuery",value:function(t,e){var r=this;this._fields=t.map(function(t){return r._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[];if(this._fields.length&&this._query){var i=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),n=i.text,o=i.values;e="("+this._fields.join(", ")+") "+this._applyNestingFormatting(n),r=o}return{text:e,values:r}}}]),n}(h.Block),h.DistinctBlock=function(t){function n(){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return r(n,t),d(n,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),n}(h.Block),h.GroupByBlock=function(t){function n(t){i(this,n);var r=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r._groups=[],r}return r(n,t),d(n,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),n}(h.Block),h.AbstractVerbSingleValueBlock=function(t){function n(t){i(this,n);var r=e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r._value=0,r}return r(n,t),d(n,[{key:"_setValue",value:function(t){this._value=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0<this._value?this.options.verb+" "+this.options.parameterCharacter:"",r=null!==this._value?[this._value]:[];return this._buildString(e,r,t)}}]),n}(h.Block),h.OffsetBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{verb:"OFFSET"})))}return r(n,t),d(n,[{key:"offset",value:function(t){this._setValue(t)}}]),n}(h.AbstractVerbSingleValueBlock),h.LimitBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{verb:"LIMIT"})))}return r(n,t),d(n,[{key:"limit",value:function(t){this._setValue(t)}}]),n}(h.AbstractVerbSingleValueBlock),h.AbstractConditionBlock=function(n){function o(t){i(this,o);var r=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return r._conditions=[],r}return r(o,n),d(o,[{key:"_condition",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];t=this._sanitizeExpression(t),this._conditions.push({expr:t,values:r})}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[],i=[],n=!0,o=!1,a=void 0;try{for(var l,u=this._conditions[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var s=l.value,f=s.expr,c=s.values,v=h.isSquelBuilder(f)?f._toParamString({buildParameterized:e.buildParameterized}):this._buildString(f,c,{buildParameterized:e.buildParameterized});v.text.length&&r.push(v.text),i.push.apply(i,t(v.values))}}catch(d){o=!0,a=d}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw a}}return r.length&&(r=r.join(") AND (")),{text:r.length?this.options.verb+" ("+r+")":"",values:i}}}]),o}(h.Block),h.WhereBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{verb:"WHERE"})))}return r(n,t),d(n,[{key:"where",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._condition.apply(this,[t].concat(r))}}]),n}(h.AbstractConditionBlock),h.HavingBlock=function(t){function n(t){return i(this,n),e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o({},t,{verb:"HAVING"})))}return r(n,t),d(n,[{key:"having",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._condition.apply(this,[t].concat(r))}}]),n}(h.AbstractConditionBlock),h.OrderByBlock=function(o){function a(t){i(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return r._orders=[],r}return r(a,o),d(a,[{key:"order",value:function(t,e){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC")),this._orders.push({field:t,dir:e,values:i})}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="",i=[],o=!0,a=!1,l=void 0;try{for(var u,s=this._orders[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=f.field,h=f.dir,v=f.values;r=n(r,", ");var d=this._buildString(c,v,{buildParameterized:e.buildParameterized});r+=d.text,i.push.apply(i,t(d.values)),null!==h&&(r+=" "+h)}}catch(p){a=!0,l=p}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}return{text:r.length?"ORDER BY "+r:"",values:i}}}]),a}(h.Block),h.JoinBlock=function(o){function a(t){i(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return r._joins=[],r}return r(a,o),d(a,[{key:"join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"INNER";t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,r=r?this._sanitizeExpression(r):r,this._joins.push({type:i,table:t,alias:e,condition:r})}},{key:"left_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"CROSS")}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="",i=[],o=!0,a=!1,l=void 0;try{for(var u,s=this._joins[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=f.type,v=f.table,d=f.alias,p=f.condition;r=n(r,this.options.separator);var _=void 0;if(h.isSquelBuilder(v)){var y=v._toParamString({buildParameterized:e.buildParameterized,nested:!0});i.push.apply(i,t(y.values)),_=y.text}else _=this._formatTableName(v);if(r+=c+" JOIN "+_,d&&(r+=" "+this._formatTableAlias(d)),p){r+=" ON ";var g=void 0;g=h.isSquelBuilder(p)?p._toParamString({buildParameterized:e.buildParameterized}):this._buildString(p,[],{buildParameterized:e.buildParameterized}),r+=this._applyNestingFormatting(g.text),i.push.apply(i,t(g.values))}}}catch(b){a=!0,l=b}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}return{text:r,values:i}}}]),a}(h.Block),h.UnionBlock=function(o){function a(t){i(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return r._unions=[],r}return r(a,o),d(a,[{key:"union",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNION";t=this._sanitizeTable(t),this._unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"_toParamString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="",i=[],o=!0,a=!1,l=void 0;try{for(var u,s=this._unions[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=f.type,v=f.table;r=n(r,this.options.separator);var d=void 0;if(v instanceof h.BaseBuilder){var p=v._toParamString({buildParameterized:e.buildParameterized,nested:!0});d=p.text,i.push.apply(i,t(p.values))}else r=this._formatTableName(v);r+=c+" "+d}}catch(_){a=!0,l=_}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}return{text:r,values:i}}}]),a}(h.Block),h.QueryBuilder=function(n){function a(t,r){i(this,a);var n=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));n.blocks=r||[];var o=!0,l=!1,u=void 0;try{for(var s,f=n.blocks[Symbol.iterator]();!(o=(s=f.next()).done);o=!0){var c=s.value,h=c.exposedMethods();for(var v in h){var d=h[v];if(void 0!==n[v])throw new Error("Builder already has a builder method called: "+v);!function(t,e,r){n[e]=function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return r.call.apply(r,[t].concat(i)),n}}(c,v,d)}}}catch(p){l=!0,u=p}finally{try{!o&&f["return"]&&f["return"]()}finally{if(l)throw u}}return n}return r(a,n),d(a,[{key:"registerValueHandler",value:function(t,e){var r=!0,i=!1,n=void 0;try{for(var o,l=this.blocks[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value;u.registerValueHandler(t,e)}}catch(s){i=!0,n=s}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw n}}return v(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=o({},this.options,t);var e=!0,r=!1,i=void 0;try{for(var n,a=this.blocks[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var l=n.value;l.options=o({},l.options,t)}}catch(u){r=!0,i=u}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw i}}}},{key:"_toParamString",value:function(){var e,r=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i=o({},this.options,i);var n=this.blocks.map(function(t){return t._toParamString({buildParameterized:i.buildParameterized,queryBuilder:r})}),a=n.map(function(t){return t.text}),l=n.map(function(t){return t.values}),u=a.filter(function(t){return 0<t.length}).join(i.separator),s=(e=[]).concat.apply(e,t(l));if(!i.nested&&i.numberedParameters){var f=void 0!==i.numberedParametersStartAt?i.numberedParametersStartAt:1,c=i.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");u=u.replace(new RegExp(c,"g"),function(){return""+i.numberedParametersPrefix+f++})}return{text:this._applyNestingFormatting(u,!!i.nested),values:s}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),a}(h.BaseBuilder),h.Select=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,n),r=r||[new h.StringBlock(t,"SELECT"),new h.FunctionBlock(t),new h.DistinctBlock(t),new h.GetFieldBlock(t),new h.FromTableBlock(t),new h.JoinBlock(t),new h.WhereBlock(t),new h.GroupByBlock(t),new h.HavingBlock(t),new h.OrderByBlock(t),new h.LimitBlock(t),new h.OffsetBlock(t),new h.UnionBlock(t)],
e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,r))}return r(n,t),n}(h.QueryBuilder),h.Update=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,n),r=r||[new h.StringBlock(t,"UPDATE"),new h.UpdateTableBlock(t),new h.SetFieldBlock(t),new h.WhereBlock(t),new h.OrderByBlock(t),new h.LimitBlock(t)],e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,r))}return r(n,t),n}(h.QueryBuilder),h.Delete=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,n),r=r||[new h.StringBlock(t,"DELETE"),new h.TargetTableBlock(t),new h.FromTableBlock(o({},t,{singleTable:!0})),new h.JoinBlock(t),new h.WhereBlock(t),new h.OrderByBlock(t),new h.LimitBlock(t)],e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,r))}return r(n,t),n}(h.QueryBuilder),h.Insert=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,n),r=r||[new h.StringBlock(t,"INSERT"),new h.IntoTableBlock(t),new h.InsertFieldValueBlock(t),new h.InsertFieldsFromQueryBlock(t)],e(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,r))}return r(n,t),n}(h.QueryBuilder);var y={VERSION:"5.9.0",flavour:c,expr:function(t){return new h.Expression(t)},"case":function(t,e){return new h.Case(t,e)},select:function(t,e){return new h.Select(t,e)},update:function(t,e){return new h.Update(t,e)},insert:function(t,e){return new h.Insert(t,e)},"delete":function(t,e){return new h.Delete(t,e)},str:function(){var t=new h.FunctionBlock;return t["function"].apply(t,arguments),t},rstr:function(){var t=new h.FunctionBlock({rawNesting:!0});return t["function"].apply(t,arguments),t},registerValueHandler:h.registerValueHandler};return y.remove=y["delete"],y.cls=h,y}var v=function y(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:y(n,e,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},d=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_=h();return _.flavours={},_.useFlavour=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t)return _;if(_.flavours[t]instanceof Function){var e=h(t);return _.flavours[t].call(null,e),e.flavours=_.flavours,e.useFlavour=_.useFlavour,e}throw new Error("Flavour not available: "+t)},_});